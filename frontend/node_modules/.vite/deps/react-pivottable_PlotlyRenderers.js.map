{
  "version": 3,
  "sources": ["../../react-pivottable/src/PlotlyRenderers.jsx"],
  "sourcesContent": ["import React from 'react';\nimport PropTypes from 'prop-types';\nimport {PivotData} from './Utilities';\n\n/* eslint-disable react/prop-types */\n// eslint can't see inherited propTypes!\n\nfunction makeRenderer(\n  PlotlyComponent,\n  traceOptions = {},\n  layoutOptions = {},\n  transpose = false\n) {\n  class Renderer extends React.PureComponent {\n    render() {\n      const pivotData = new PivotData(this.props);\n      const rowKeys = pivotData.getRowKeys();\n      const colKeys = pivotData.getColKeys();\n      const traceKeys = transpose ? colKeys : rowKeys;\n      if (traceKeys.length === 0) {\n        traceKeys.push([]);\n      }\n      const datumKeys = transpose ? rowKeys : colKeys;\n      if (datumKeys.length === 0) {\n        datumKeys.push([]);\n      }\n\n      let fullAggName = this.props.aggregatorName;\n      const numInputs =\n        this.props.aggregators[fullAggName]([])().numInputs || 0;\n      if (numInputs !== 0) {\n        fullAggName += ` of ${this.props.vals.slice(0, numInputs).join(', ')}`;\n      }\n\n      const data = traceKeys.map(traceKey => {\n        const values = [];\n        const labels = [];\n        for (const datumKey of datumKeys) {\n          const val = parseFloat(\n            pivotData\n              .getAggregator(\n                transpose ? datumKey : traceKey,\n                transpose ? traceKey : datumKey\n              )\n              .value()\n          );\n          values.push(isFinite(val) ? val : null);\n          labels.push(datumKey.join('-') || ' ');\n        }\n        const trace = {name: traceKey.join('-') || fullAggName};\n        if (traceOptions.type === 'pie') {\n          trace.values = values;\n          trace.labels = labels.length > 1 ? labels : [fullAggName];\n        } else {\n          trace.x = transpose ? values : labels;\n          trace.y = transpose ? labels : values;\n        }\n        return Object.assign(trace, traceOptions);\n      });\n\n      let titleText = fullAggName;\n      const hAxisTitle = transpose\n        ? this.props.rows.join('-')\n        : this.props.cols.join('-');\n      const groupByTitle = transpose\n        ? this.props.cols.join('-')\n        : this.props.rows.join('-');\n      if (hAxisTitle !== '') {\n        titleText += ` vs ${hAxisTitle}`;\n      }\n      if (groupByTitle !== '') {\n        titleText += ` by ${groupByTitle}`;\n      }\n\n      const layout = {\n        title: titleText,\n        hovermode: 'closest',\n        /* eslint-disable no-magic-numbers */\n        width: window.innerWidth / 1.5,\n        height: window.innerHeight / 1.4 - 50,\n        /* eslint-enable no-magic-numbers */\n      };\n\n      if (traceOptions.type === 'pie') {\n        const columns = Math.ceil(Math.sqrt(data.length));\n        const rows = Math.ceil(data.length / columns);\n        layout.grid = {columns, rows};\n        data.forEach((d, i) => {\n          d.domain = {\n            row: Math.floor(i / columns),\n            column: i - columns * Math.floor(i / columns),\n          };\n          if (data.length > 1) {\n            d.title = d.name;\n          }\n        });\n        if (data[0].labels.length === 1) {\n          layout.showlegend = false;\n        }\n      } else {\n        layout.xaxis = {\n          title: transpose ? fullAggName : null,\n          automargin: true,\n        };\n        layout.yaxis = {\n          title: transpose ? null : fullAggName,\n          automargin: true,\n        };\n      }\n\n      return (\n        <PlotlyComponent\n          data={data}\n          layout={Object.assign(\n            layout,\n            layoutOptions,\n            this.props.plotlyOptions\n          )}\n          config={this.props.plotlyConfig}\n          onUpdate={this.props.onRendererUpdate}\n        />\n      );\n    }\n  }\n\n  Renderer.defaultProps = Object.assign({}, PivotData.defaultProps, {\n    plotlyOptions: {},\n    plotlyConfig: {},\n  });\n  Renderer.propTypes = Object.assign({}, PivotData.propTypes, {\n    plotlyOptions: PropTypes.object,\n    plotlyConfig: PropTypes.object,\n    onRendererUpdate: PropTypes.func,\n  });\n\n  return Renderer;\n}\n\nfunction makeScatterRenderer(PlotlyComponent) {\n  class Renderer extends React.PureComponent {\n    render() {\n      const pivotData = new PivotData(this.props);\n      const rowKeys = pivotData.getRowKeys();\n      const colKeys = pivotData.getColKeys();\n      if (rowKeys.length === 0) {\n        rowKeys.push([]);\n      }\n      if (colKeys.length === 0) {\n        colKeys.push([]);\n      }\n\n      const data = {x: [], y: [], text: [], type: 'scatter', mode: 'markers'};\n\n      rowKeys.map(rowKey => {\n        colKeys.map(colKey => {\n          const v = pivotData.getAggregator(rowKey, colKey).value();\n          if (v !== null) {\n            data.x.push(colKey.join('-'));\n            data.y.push(rowKey.join('-'));\n            data.text.push(v);\n          }\n        });\n      });\n\n      const layout = {\n        title: this.props.rows.join('-') + ' vs ' + this.props.cols.join('-'),\n        hovermode: 'closest',\n        /* eslint-disable no-magic-numbers */\n        xaxis: {title: this.props.cols.join('-'), automargin: true},\n        yaxis: {title: this.props.rows.join('-'), automargin: true},\n        width: window.innerWidth / 1.5,\n        height: window.innerHeight / 1.4 - 50,\n        /* eslint-enable no-magic-numbers */\n      };\n\n      return (\n        <PlotlyComponent\n          data={[data]}\n          layout={Object.assign(layout, this.props.plotlyOptions)}\n          config={this.props.plotlyConfig}\n          onUpdate={this.props.onRendererUpdate}\n        />\n      );\n    }\n  }\n\n  Renderer.defaultProps = Object.assign({}, PivotData.defaultProps, {\n    plotlyOptions: {},\n    plotlyConfig: {},\n  });\n  Renderer.propTypes = Object.assign({}, PivotData.propTypes, {\n    plotlyOptions: PropTypes.object,\n    plotlyConfig: PropTypes.object,\n    onRendererUpdate: PropTypes.func,\n  });\n\n  return Renderer;\n}\n\nexport default function createPlotlyRenderers(PlotlyComponent) {\n  return {\n    'Grouped Column Chart': makeRenderer(\n      PlotlyComponent,\n      {type: 'bar'},\n      {barmode: 'group'}\n    ),\n    'Stacked Column Chart': makeRenderer(\n      PlotlyComponent,\n      {type: 'bar'},\n      {barmode: 'relative'}\n    ),\n    'Grouped Bar Chart': makeRenderer(\n      PlotlyComponent,\n      {type: 'bar', orientation: 'h'},\n      {barmode: 'group'},\n      true\n    ),\n    'Stacked Bar Chart': makeRenderer(\n      PlotlyComponent,\n      {type: 'bar', orientation: 'h'},\n      {barmode: 'relative'},\n      true\n    ),\n    'Line Chart': makeRenderer(PlotlyComponent),\n    'Dot Chart': makeRenderer(PlotlyComponent, {mode: 'markers'}, {}, true),\n    'Area Chart': makeRenderer(PlotlyComponent, {stackgroup: 1}),\n    'Scatter Chart': makeScatterRenderer(PlotlyComponent),\n    'Multiple Pie Chart': makeRenderer(\n      PlotlyComponent,\n      {type: 'pie', scalegroup: 1, hoverinfo: 'label+value', textinfo: 'none'},\n      {},\n      true\n    ),\n  };\n}\n"],
  "mappings": "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",
  "names": ["createPlotlyRenderers", "makeRenderer", "PlotlyComponent", "traceOptions", "layoutOptions", "transpose", "Renderer", "pivotData", "PivotData", "props", "rowKeys", "getRowKeys", "colKeys", "getColKeys", "traceKeys", "length", "push", "datumKeys", "fullAggName", "aggregatorName", "numInputs", "aggregators", "vals", "slice", "join", "data", "map", "values", "labels", "datumKey", "val", "parseFloat", "getAggregator", "traceKey", "value", "isFinite", "trace", "name", "type", "x", "y", "Object", "assign", "titleText", "hAxisTitle", "rows", "cols", "groupByTitle", "layout", "title", "hovermode", "width", "window", "innerWidth", "height", "innerHeight", "columns", "Math", "ceil", "sqrt", "grid", "forEach", "d", "i", "domain", "row", "floor", "column", "showlegend", "xaxis", "automargin", "yaxis", "plotlyOptions", "plotlyConfig", "onRendererUpdate", "React", "PureComponent", "defaultProps", "propTypes", "PropTypes", "object", "func", "makeScatterRenderer", "text", "mode", "v", "rowKey", "colKey", "barmode", "orientation", "stackgroup", "scalegroup", "hoverinfo", "textinfo"]
}
